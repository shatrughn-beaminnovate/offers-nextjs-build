(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[389],{962:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/dashboard/page/[[...pageID]]",function(){return a(7844)}])},7844:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var r=a(5893),l=a(7294),s=a(3942),o=a.n(s),i=a(9134),c=a(221),n=a(4863),d=e=>{let{onImagesChange:t=()=>{},s3imageUrlArray:s,setS3imageUrlArray:d,tag:u,imageName:m,clearImages:g}=e,h="https://lmsservice.unicornstore.in",[p,f]=(0,l.useState)([]),[x,y]=(0,l.useState)(""),[v,j]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[N,C]=(0,l.useState)("");(0,l.useEffect)(()=>{s&&s[u]&&(s[u],f([{data_url:s[u]}]),C(s[u]),y(u))},[s,u]);let S=e=>{d(t=>{let a={...t};return delete a[e],a})};(0,l.useEffect)(()=>{g&&g(()=>f([]))},[g]);let T=e=>{let[t,a]=e.split(","),r=t.split(":")[1].split(";")[0],l=atob(a),s=new ArrayBuffer(l.length),o=new Uint8Array(s);for(let e=0;e<l.length;e++)o[e]=l.charCodeAt(e);return new Blob([s],{type:r})},_=(e,t)=>new File([e],t,{type:e.type}),E=async e=>{try{let t=a(1616);if(!("image/heic"===e.type||"image/heif"===e.type||/\.(heic|heif)$/i.test(e.name)))return e;{let a=await t({blob:e,toType:"image/png"}),r=e.name.split(".").slice(0,-1).join(".");return new File([a],"".concat(r,".png"),{type:"image/png"})}}catch(t){return console.error("Error converting HEIC to PNG: ",t),e}},I=async e=>{try{j(!0);let t=await E(e[0]),a=await (0,c.Z)(t,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}),r=new FormData;r.append("file",a);let l=await fetch("".concat(h,"/upload-image"),{method:"POST",body:r});if(!l.ok)throw Error("Failed to upload images");let s=await l.json();if("success"===s.status)d(e=>({...e,[u]:s.url})),y(s.s3_image),C(s.url),w(!1);else throw Error(s.message)}catch(e){console.error("Error uploading images:",e),i.Am.error(e.message,{toastId:"UploadMiscImageError"}),w(!0)}finally{j(!1)}},k=(0,l.useCallback)((e,a)=>{f(e),t(e,a),I(e.map(e=>_(T(e.data_url),"image_".concat(m,".jpg"))))},[t,u,m,I]),P=async e=>{try{if(!(await fetch("".concat(h,"/remove-image?url=").concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete image")}catch(e){console.error("Error deleting image:",e)}},O=async()=>{try{await P(N),S(x),f([]),d(e=>{let t={...e};return delete t[x],t})}catch(e){console.error("Error removing image:",e),i.Am.error(e.message,{toastId:"ImageRemoveError"})}};return v?(0,r.jsx)("div",{className:"w-full max-h-full h-full relative grid place-content-center",children:(0,r.jsx)(n.c,{color:"success"})}):(0,r.jsx)("div",{className:"w-full h-full max-h-full relative",children:(0,r.jsx)(o(),{value:p,onChange:k,dataURLKey:"data_url",children:e=>{let{imageList:t,onImageUpload:a,isDragging:l,dragProps:s,errors:o}=e;return(0,r.jsxs)("div",{className:"flex flex-col w-full h-full items-center justify-center max-h-full",children:[(0,r.jsx)("button",{onClick:a,...s,className:"w-full h-full content-center absolute top-0 left-0  outline-none ".concat(l?"text-red-500":""),children:!o&&(0,r.jsx)("span",{className:"".concat(p.length>0?"hidden":""," "),children:b?"Failed to upload image, please try again":"Click here to upload or Drop here"})}),(0,r.jsx)("div",{className:"overflow-y-scroll scrollbar-hidden z-10 w-full",children:(0,r.jsx)("div",{className:"flex items-center justify-center w-full space-y-5",children:b?"Failed to upload image, please try again":t.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-start md:justify-center ",children:[(0,r.jsx)("div",{className:"flex flex-row absolute right-1 space-x-1 top-1 h-full",children:(0,r.jsx)("button",{className:"text-red-500 hover:bg-red-500 hover:text-white transition-all bg-red-100 rounded px-2 text-xl h-fit sticky top-1 fas fa-xmark",onClick:e=>{e.stopPropagation(),O(t)}})}),(0,r.jsx)("img",{className:"h-full",src:N,alt:""})]},t))})})]})}})})},u=a(5612),m=a(4039),g=e=>{let{header:t,...a}=e;return(0,r.jsx)(m.Q,{...a,header:e=>{let{state:{isEnter:a}}=e;return(0,r.jsxs)(r.Fragment,{children:[t,(0,r.jsx)("i",{className:"bi bi-chevron-down ml-auto transition-transform duration-200 ease-out flex items-center ".concat(a&&"rotate-180")})]})},buttonProps:{className:e=>{let{isEnter:t}=e;return"flex items-center w-full px-4 py-1 text-left hover:bg-[#42c8b725] ".concat(t&&"bg-[#42c8b725]")}},contentProps:{className:"transition-height duration-200 ease-out"},panelProps:{className:"py-4"}})},h=a(9066),p=a(6670),f=a(9008),x=a.n(f),y=a(3788),v=a(7916),j=a(8794),b=a(1163),w=a(843),N=()=>{let e="https://lmsservice.unicornstore.in",t=(0,b.useRouter)(),{pageID:a}=t.query,[s,o]=(0,l.useState)({name:"",email:"",phone:"",otp:"",state:"",city:"",store:"",device_type:"",device_name:"",device_variant:""}),[c,n]=(0,l.useState)({seoTitle:"",productTitle:"",meta:"",slug:"",productCategory:"",model:"",variant:"",formID:""}),[m,f]=(0,l.useState)({}),[N,C]=(0,l.useState)(!1),[S,T]=(0,l.useState)({}),[_,E]=(0,l.useState)({}),[I,k]=(0,l.useState)(!1),[P,O]=(0,l.useState)([]),[A,D]=(0,l.useState)([]),[F,U]=(0,l.useState)([]),[X,q]=(0,l.useState)(!1),[R,B]=(0,l.useState)(""),[K,L]=(0,l.useState)(!1),[G,J]=(0,l.useState)(!0),[M,V]=(0,l.useState)(""),W=(0,l.useRef)(null),[Z,$]=(0,l.useState)({page:!0,submit:!1}),[z,H]=(0,l.useState)({category:[{label:"",value:""}],model:[{label:"",value:""}],variant:[{label:"",value:""}]});(0,l.useEffect)(()=>{(async()=>{try{let t=await fetch("".concat(e,"/get-all-states"));if(!t.ok)throw Error("Could not get states");let a=await t.json();if("success"!==a.status)throw Error(a.message);O(a.data.map(e=>({value:e.state_id,label:e.state_name})));let r=await fetch("".concat(e,"/get-city-by-state"));if(!r.ok)throw Error("Could not get cities");let l=await r.json();if("success"!==l.status)throw Error(l.message);D(l.data.map(e=>({value:e.city_id,label:e.city_name})));let s=await fetch("".concat(e,"/get-store-by-city"));if(!s.ok)throw Error("Could not get Stores");let o=await s.json();if("success"!==o.status)throw Error(o.message);U(o.data.map(e=>({value:e.store_id,label:e.store_name})))}catch(e){console.log(e.message),i.Am.error(e.message)}})()},[]);let Q=e=>{},Y=(e,t)=>{let a=null==e?void 0:e.value;o(e=>({...e,[t]:a}))},ee=e=>{let{name:t,value:a}=e.target;n(e=>({...e,[t]:"slug"===t?a.trim():a})),E(e=>{let r={...e};return"productTitle"===t&&(a.trim()?delete r.productTitle:r.productTitle="Product Title is required"),"slug"===t&&(/\s/.test(a)?r.slug="Slug cannot contain spaces":delete r.slug),r})},et=e=>t=>{console.log({field:e,value:t}),n(a=>({...a,[e]:t}))};(0,l.useEffect)(()=>{I&&E(e=>{let t={...e};return(null==m?void 0:m.length)!==0&&m?delete t.s3imageUrlArray:t.s3imageUrlArray="Image is required",t})},[m]);let ea=()=>{C(!0),setTimeout(()=>{C(!1)},2500),console.log("Getting OTP...")},er=()=>{let e={};return s.name.trim()||(e.name="Name is required"),s.phone.trim()||(e.phone="Phone Number is required"),s.otp.trim()||(e.otp="OTP is required"),s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(e.email="Email is invalid"):e.email="Email is required",s.state||(e.state="State is required"),T(e),0===Object.keys(e).length},el=e=>{e.preventDefault(),er()&&(console.log("valid form"),console.log(s))},es=()=>{var e,t,a;let r={};return(null==c?void 0:null===(e=c.productTitle)||void 0===e?void 0:e.trim())||(r.productTitle="Product Title is required"),/\s/.test(c.slug)&&(r.slug="Slug cannot contain spaces"),(null===(t=c.formID)||void 0===t?void 0:t.trim())||(r.formID="Please Select a form"),(null===(a=Object.values(m))||void 0===a?void 0:a.length)!==0&&m||(r.s3imageUrlArray="Image is required"),E(r),0===Object.keys(r).length},eo=async()=>{if(k(!0),es())try{let t=await fetch("".concat(e,"/").concat(a?"update-meta-form/".concat(a):"create-meta-form"),{headers:{"Content-Type":"application/json"},method:a?"PUT":"POST",body:JSON.stringify({title:c.seoTitle,slug:c.slug||c.productTitle.toLowerCase().split(" ").join("-"),product_title:c.productTitle,device_type:c.productCategory,device_name:c.model,device_variant:c.variant,image:m.creativeImage,form_type:G?"form-1":"form-2"})});if(!t.ok)throw Error("Could not create meta form");let r=await t.json();"success"===r.status?(i.Am.success("Form ".concat(a?"Updated":"Created"," Successfully!")),q(!0),window.scrollTo({top:0,behavior:"smooth"})):(i.Am.warn(r.message),q(!1)),"info"===r.status&&i.Am.info(r.message,{toastId:"infoToast"})}catch(e){i.Am.error(e.message),console.log(e)}};(0,l.useEffect)(()=>{let{protocol:e,hostname:t,port:r}=window.location;V("".concat(e,"//").concat(t).concat(r?":".concat(r):"")),en(),a&&ei()},[t,t.isReady]);let ei=async()=>{try{$(e=>({...e,page:!0}));let t=await fetch("".concat(e,"/get-meta-form-by-id/?id=").concat(a));if(!t.ok)throw Error("Could not get page data");let r=await t.json();if("success"!==r.status)throw Error(r.message);console.log({parsedPageDataRes:r}),n(e=>({...e,seoTitle:r.form_data.title,productTitle:r.form_data.product_title,slug:r.form_data.slug,productCategory:r.form_data.device_type,model:r.form_data.device_name,variant:r.form_data.device_variant,formID:r.form_data.form_type})),f(e=>({...e,creativeImage:r.form_data.image_url}))}catch(e){i.Am.error(e.message)}finally{setTimeout(()=>{$(e=>({...e,page:!1}))},300)}},ec=async()=>{let{protocol:e,hostname:t,port:a}=window.location;if(!/^([^=&]+=[^=&]+)(&[^=&]+=[^=&]+)*$/.test(R)){L("Invalid slug format. Must be in 'key=value' format.");return}let r="".concat(e,"//").concat(t).concat(a?":".concat(a):"","/upgrade/").concat(c.slug||c.productTitle.toLowerCase().split(" ").join("-"),"?").concat(R).split(" ").join("");if(navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)navigator.clipboard.writeText(r).then(()=>{L("Copied!"),setTimeout(()=>L(!1),2e3)},()=>{console.error("Failed to copy the text.")});else{let e=document.createElement("textarea");e.value=r,document.body.appendChild(e),e.select();try{document.execCommand("copy"),L("Copied!"),setTimeout(()=>L(!1),2e3)}catch(e){console.error("Failed to copy: ",e),i.Am.warn(e.message,{toastId:"errorToast"})}}},en=async()=>{try{$(e=>({...e,page:!0}));let t=await fetch("".concat(e,"/get-device-hierarchy"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!t.ok)throw Error("Could not get product categories");let a=await t.json();if("success"!==a.status)throw Error(a.message);H(e=>({...e,category:a.top_level}))}catch(e){i.Am.error(e.message)}finally{a||$(e=>({...e,page:!1}))}},ed=async()=>{try{let t=await fetch("".concat(e,"/get-device-hierarchy"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_type:c.productCategory})});if(!t.ok)throw Error("Could not get product categories");let a=await t.json();if("success"!==a.status)throw Error(a.message);H(e=>({...e,model:a.device_names}))}catch(e){i.Am.error(e.message)}},eu=async()=>{try{let t=await fetch("".concat(e,"/get-device-hierarchy"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_type:c.productCategory,device_name:c.model})});if(!t.ok)throw Error("Could not get product categories");let a=await t.json();if("success"!==a.status)throw Error(a.message);H(e=>({...e,variant:a.device_variants}))}catch(e){i.Am.error(e.message)}};return((0,l.useEffect)(()=>{c.productCategory&&ed()},[c.productCategory]),(0,l.useEffect)(()=>{c.model&&eu()},[c.model]),(0,l.useEffect)(()=>{c.productCategory||n(e=>({...e,model:null})),c.model||n(e=>({...e,variant:null}))},[c.productCategory,c.model]),Z.page)?(0,r.jsxs)("div",{className:"relative space-y-5",children:[(0,r.jsx)(x(),{children:(0,r.jsx)("title",{children:"Offer Unicorn - Page"})}),(0,r.jsxs)("div",{className:"relative space-y-2",children:[(0,r.jsx)(w.X,{className:"w-40 h-8 rounded-full mx-auto"}),(0,r.jsx)(w.X,{className:"w-20 h-5 rounded-full"}),(0,r.jsx)(w.X,{className:"w-full h-8 rounded-full"})]}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(w.X,{className:"w-full h-16 rounded-lg"})}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(w.X,{className:"w-40 h-8 rounded-full"})}),(0,r.jsxs)("div",{className:"relative grid grid-cols-3 gap-x-4",children:[(0,r.jsx)(w.X,{className:"w-full h-12 rounded-lg"}),(0,r.jsx)(w.X,{className:"w-full h-12 rounded-lg"}),(0,r.jsx)(w.X,{className:"w-full h-12 rounded-lg"})]}),(0,r.jsxs)("div",{className:"h-[70vh] grid grid-cols-2 gap-x-4 xl:gap-x-16",children:[(0,r.jsx)(w.X,{className:"w-full h-full rounded-lg"}),(0,r.jsx)(w.X,{className:"w-full h-full rounded-lg"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x(),{children:(0,r.jsxs)("title",{children:["Offer Unicorn - ",a?"Update":"Create"]})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-center mb-5",children:a?"Update Page ".concat(a):"Create Page"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 xl:gap-x-16 gap-y-5",children:[X&&(0,r.jsxs)("div",{className:"rounded border border-green-300 bg-green-100 py-2 col-span-2 px-2",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Slug: "}),(0,r.jsxs)("span",{children:[M,"/upgrade/",c.slug||c.productTitle.toLowerCase().split(" ").join("-"),"?",R,(0,r.jsxs)("button",{className:"ms-4 text-gray-500 hover:text-gray-800",onClick:ec,children:[(0,r.jsx)("i",{className:"bi bi-copy me-2"}),K]})]}),(0,r.jsx)("div",{className:"relative col-span-2",children:(0,r.jsx)("input",{type:"text",value:R,onChange:e=>B(e.target.value.split(" ").join("")),className:"border px-3 py-2 rounded w-full outline-none transition-all duration-200",placeholder:"Slug"})})]}),(0,r.jsxs)("div",{className:"col-span-2 grid grid-cols-2 gap-x-4 xl:gap-x-16 gap-y-5 ",children:[(0,r.jsxs)("div",{className:"relative col-span-2",children:[(0,r.jsxs)("label",{htmlFor:"productTitle",className:"font-medium text-gray-700",children:["Page Title ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",id:"productTitle",name:"productTitle",value:c.productTitle,onChange:ee,className:"border px-3 py-2 rounded w-full ring-border ".concat(_.productTitle?"border-red-300":""),placeholder:"Title"}),_.productTitle&&(0,r.jsx)("span",{className:"text-red-400 text-xs absolute -bottom-4 left-0",children:_.productTitle})]}),(0,r.jsx)(u.U,{className:"bg-white border rounded-lg col-span-2",transition:!0,transitionTimeout:250,children:(0,r.jsx)(g,{header:(0,r.jsx)("div",{className:"flex justify-between items-center text-xl font-semibold text-gray-800 cursor-pointer py-2",children:(0,r.jsx)("span",{className:"w-full",children:"SEO data"})}),children:(0,r.jsxs)("div",{className:"col-span-2 grid grid-cols-2 gap-x-4 gap-y-5 px-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("label",{htmlFor:"seoTitle",className:"font-medium text-gray-700",children:"SEO Title"}),(0,r.jsx)("input",{type:"text",id:"seoTitle",name:"seoTitle",value:c.seoTitle,onChange:ee,className:"border px-3 py-2 rounded w-full ring-border  ".concat(_.seoTitle?"border-red-300":""),placeholder:"SEO Title"}),_.seoTitle&&(0,r.jsx)("span",{className:"text-red-400 text-xs absolute -bottom-4 left-0",children:_.seoTitle})]}),(0,r.jsxs)("div",{className:"relative h-fit",children:[(0,r.jsx)("label",{htmlFor:"slug",className:"font-medium text-gray-700",children:"Slug (No spaces allowed)"}),(0,r.jsx)("input",{type:"text",id:"slug",name:"slug",value:c.slug,onChange:ee,className:"border px-3 py-2 rounded w-full ring-border ".concat(_.slug?"border-red-300":""),placeholder:"Slug"}),_.slug&&(0,r.jsx)("span",{className:"text-red-400 text-xs absolute -bottom-4 left-0",children:_.slug})]})]})})})]}),(0,r.jsx)("div",{className:"col-span-2 grid grid-cols-1 relative  gap-y-3",children:(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)(y.K,{color:"success",className:"text-white ring-accent",isSelected:!G,onValueChange:()=>{J(e=>!e)},children:"Pre-Book Form?"})})}),(0,r.jsxs)("div",{className:"relative col-span-2 grid grid-cols-3 gap-x-4",children:[(0,r.jsx)(v.d,{label:"Product Category",placeholder:"Search a Product",defaultItems:z.category,variant:"bordered",radius:"sm",selectedKey:c.productCategory,onSelectionChange:et("productCategory"),classNames:{listboxWrapper:"rounded"},isDisabled:!z.category,children:e=>(0,r.jsx)(j.R,{children:e.label},e.value)}),(0,r.jsx)(v.d,{label:"Model",placeholder:"Search a model",defaultItems:z.model,variant:"bordered",radius:"sm",selectedKey:c.model,onSelectionChange:et("model"),isDisabled:!c.productCategory||!z.model,children:e=>(0,r.jsx)(j.R,{children:e.label},e.value)}),(0,r.jsx)(v.d,{label:"Variant",placeholder:"Search a variant",defaultItems:z.variant,variant:"bordered",radius:"sm",selectedKey:c.variant,onSelectionChange:et("variant"),isDisabled:!c.model||!z.variant,children:e=>(0,r.jsx)(j.R,{children:e.label},e.value)})]}),(0,r.jsxs)("div",{className:"border-2 border-dashed focus-within:border-[#42c8b7] relative min-h-[760px] ".concat(_.s3imageUrlArray?"border-red-300":""),children:[(0,r.jsx)(d,{s3imageUrlArray:m,setS3imageUrlArray:f,tag:"creativeImage",imageName:"creativeImage",clearImages:e=>W.current=e}),_.s3imageUrlArray&&(0,r.jsx)("span",{className:"text-red-400 text-xs absolute -bottom-4 left-0",children:_.s3imageUrlArray})]}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsxs)("div",{className:"mx-auto p-6 bg-white border border-gray-300 rounded relative ".concat(_.formID?"border-red-300":""),children:[(0,r.jsx)("div",{className:"border rounded block pe-2 w-full",children:(0,r.jsxs)("select",{name:"formID",id:"formID",className:"w-full px-3 py-2 ring-accent",value:c.formID,onChange:ee,children:[(0,r.jsx)("option",{value:"",disabled:!0,children:"Select a Form"}),G&&(0,r.jsx)("option",{value:"form-1",children:"Form 1"}),!G&&(0,r.jsx)("option",{value:"form-2",children:"Pre-Book Form"})]})}),"form-1"===c.formID&&(0,r.jsx)(h.Z,{formData:s,errors:S,otpSentVisible:N,currentStates:P,currentCities:A,currentStores:F,handleChange:Q,handleGetOtp:ea,handleFormSubmit:el,dropdownItems:z,handleSelectionChange:Q}),"form-2"===c.formID&&(0,r.jsx)(p.Z,{formData:s,errors:S,otpSentVisible:N,currentStates:P,currentCities:A,currentStores:F,handleChange:Q,handleGetOtp:ea,handleStateChange:e=>{Y(e,"state")},handleCityChange:e=>{Y(e,"city")},handleStoreChange:e=>{Y(e,"store")},handleFormSubmit:el}),_.formID&&(0,r.jsx)("span",{className:"text-red-400 text-xs absolute -bottom-4 left-0",children:_.formID})]})}),(0,r.jsx)("div",{className:"col-span-2  grid grid-cols-3",children:(0,r.jsxs)("button",{className:"col-start-2 bg-accent text-white text-center py-1 rounded ring-accent",onClick:eo,children:[a?"Update":"Create"," Page"]})})]})]})}}},function(e){e.O(0,[838,142,945,843,282,888,774,179],function(){return e(e.s=962)}),_N_E=e.O()}]);