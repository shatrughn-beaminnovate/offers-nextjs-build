(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{4817:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/upgrade/[phoneID]",function(){return a(147)}])},147:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return h}});var r=a(5893),s=a(5675),i=a.n(s),n=a(1163),o=a(7294),c=a(9134),l=a(9066),d=a(9008),m=a.n(d),u=a(6670),h=!0;t.default=e=>{var t,a,s;let{seoTitle:d,productTitle:h,imageUrl:p,formID:v,stateList:f,cityList:g,storeList:y,pageError:_,pageData:x}=e,w="https://lmsservice.unicornstore.in",j=(0,n.useRouter)(),S=j.query,[b,N]=(0,o.useState)({name:"",email:"",phone:"",otp:"",state:"",city:"",store:"",device_type:null!==(t=x.device_type)&&void 0!==t?t:"",device_name:null!==(a=x.device_name)&&void 0!==a?a:"",device_variant:null!==(s=x.device_variant)&&void 0!==s?s:""}),[C,E]=(0,o.useState)(!1),[P,q]=(0,o.useState)({}),[O,T]=(0,o.useState)(!1),[k,I]=(0,o.useState)(g),[A,D]=(0,o.useState)(y),[F,J]=(0,o.useState)({category:[{label:"",value:""}],model:[{label:"",value:""}],variant:[{label:"",value:""}]});(0,o.useEffect)(()=>{b.state?I(g.filter(e=>e.state_id===parseInt(b.state))):I([])},[b.state,g]),(0,o.useEffect)(()=>{if(console.log({stateList:f,cityList:g,storeList:y}),b.city){let e=y.filter(e=>e.city_id===parseInt(b.city));D(e),e.find(e=>e.value===b.store)||N(e=>({...e,store:""}))}else b.state?D(y.filter(e=>e.state_id===b.state)):D(y)},[b.city,b.state,y]);let V=e=>{let{name:t,value:a}=e.target;N({...b,[t]:a}),q(e=>{let r={...e};return"name"!==t||a.trim()?"name"===t&&(r.name=""):r.name="Name is required","email"===t&&(a.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?r.email="":r.email="Email is invalid":r.email="Email is required"),"phone"!==t||a.trim()?"phone"===t&&(r.phone=""):r.phone="Phone Number is required","otp"!==t||a.trim()?"otp"===t&&(r.otp=""):r.otp="OTP is required","state"!==t||a?"state"===t&&(r.state=""):r.state="State is required","device_type"===t&&(a?r.device_type="":r.device_type="Product Category is required"),"device_name"===t&&(a?r.device_name="":r.device_name="Model is required"),"device_variant"===t&&(a?r.device_variant="":r.device_variant="Variant is required"),r})},M=(e,t)=>{let a=null==e?void 0:e.value;N(e=>({...e,[t]:a}))};(0,o.useEffect)(()=>{localStorage.removeItem("customer-id"),localStorage.setItem("form-type",v),Z()},[]);let G=async()=>{T(!0);try{let e=await fetch("".concat(w,"/send-otp?phone_number=").concat(b.phone),{method:"POST"});if(!e.ok)throw Error("Could not generate OTP");let t=await e.json();"success"===t.status?(E(!0),setTimeout(()=>{E(!1)},2500)):c.Am.warn(t.reason,{toastId:"warnToast"})}catch(e){console.log(e),c.Am.error(e.message,{toastId:"errorToast"})}T(!1)},R=()=>{let e={};return b.name.trim()||(e.name="Name is required"),b.phone.trim()||(e.phone="Phone Number is required"),b.otp.trim()||(e.otp="OTP is required"),b.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b.email)||(e.email="Email is invalid"):e.email="Email is required",""===b.product&&(e.product="Product is required"),""===b.state&&(e.state="State is required"),""===b.device_type&&(e.device_type="Product Category is required"),""===b.device_name&&(e.device_name="Model is required"),""===b.device_variant&&(e.device_variant="Variant is required"),q(e),0===Object.keys(e).length},X=async e=>{if(e.preventDefault(),R())try{let e=await fetch("".concat(w,"/create-form-submission/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{...b,form_name:v,url_data:S}})});if(!e.ok)throw Error("Could not create form");let t=await e.json();"success"!==t.status&&c.Am.info(t.message,{toastId:"infoMessage"}),"success"===t.status&&"form-2"===v?(localStorage.setItem("customer-id",t.form_id),j.push("".concat(S.phoneID,"/payment"))):"success"===t.status&&"form-1"===v&&j.push("".concat(S.phoneID,"/thanks"))}catch(e){console.log(e),c.Am.error("Could not create form")}};(0,o.useEffect)(()=>{b.device_type||N(e=>({...e,device_name:null})),b.device_name||N(e=>({...e,device_variant:null}))},[b.device_type,b.device_name]);let Z=async()=>{try{let e=await fetch("".concat(w,"/get-device-hierarchy"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!e.ok)throw Error("Could not get product categories");let t=await e.json();if("success"!==t.status)throw Error(t.message);J(e=>({...e,category:t.top_level}))}catch(e){c.Am.error(e.message)}},$=async()=>{try{let e=await fetch("".concat(w,"/get-device-hierarchy"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_type:b.device_type})});if(!e.ok)throw Error("Could not get product categories");let t=await e.json();if("success"!==t.status)throw Error(t.message);J(e=>({...e,model:t.device_names}))}catch(e){c.Am.error(e.message)}},L=async()=>{try{let e=await fetch("".concat(w,"/get-device-hierarchy"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_type:b.device_type,device_name:b.device_name})});if(!e.ok)throw Error("Could not get product categories");let t=await e.json();if("success"!==t.status)throw Error(t.message);J(e=>({...e,variant:t.device_variants}))}catch(e){c.Am.error(e.message)}};return((0,o.useEffect)(()=>{b.device_type&&$()},[b.device_type]),(0,o.useEffect)(()=>{b.device_name&&L()},[b.device_name]),_)?(0,r.jsx)("div",{className:"w-screen flex justify-center items-center mt-20 ",children:(0,r.jsxs)("div",{className:"container max-w-screen-lg bg-white shadow-lg rounded-lg p-8 text-red-500 text-center space-y-4",children:[(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("i",{className:"bi bi-exclamation-triangle-fill text-red-500 text-6xl"})}),(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Oops! Something went wrong."}),(0,r.jsx)("p",{className:"text-lg text-gray-600",children:"We encountered an error while trying to fetch the data."}),(0,r.jsx)("p",{children:_}),(0,r.jsx)("button",{className:"bg-red-500 text-white font-semibold px-6 py-3 rounded-full hover:bg-red-600 transition duration-300",onClick:()=>j.reload(),children:"Retry"})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m(),{children:(0,r.jsx)("title",{children:d})}),(0,r.jsx)("div",{className:"w-screen flex justify-center mt-6 sm:mt-0",children:(0,r.jsxs)("div",{className:"container max-w-screen-xl grid grid-cols-2 gap-x-5 gap-y-5",children:[(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsxs)("p",{className:"text-3xl font-semibold text-center",children:["form-1"===v&&"Upgrade","form-2"===v&&"Prebook"," ",h]})}),(0,r.jsx)("div",{className:"flex justify-center items-center col-span-2 sm:col-span-1 ",children:(0,r.jsx)(i(),{className:"max-w-48 sm:max-w-none h-full object-contain w-full",src:p||"/ImageNotFound.png",alt:"iPhone 15",width:350,height:100})}),(0,r.jsxs)("div",{className:"max-w-2xl  p-6 bg-white border border-gray-300 rounded col-span-2 sm:col-span-1 mx-2 sm:mx-0",children:["form-1"===v&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.Z,{formData:b,errors:P,otpSentVisible:C,phoneList:[{label:"iPhone 12",value:"iPhone 12"}],currentStates:f,currentCities:k,currentStores:A,handleChange:V,handleGetOtp:G,handleFormSubmit:X,dropdownItems:F,handleSelectionChange:e=>t=>{V({target:{name:e,value:t}})},pageData:x})}),"form-2"===v&&(0,r.jsx)(u.Z,{formData:b,errors:P,otpSentVisible:C,handlePhoneChange:e=>{M(e,"product")},currentStates:f,currentCities:k,currentStores:A,handleChange:V,handleGetOtp:G,handleStateChange:e=>{M(e,"state")},handleCityChange:e=>{M(e,"city")},handleStoreChange:e=>{M(e,"store")},handleFormSubmit:X})]})]})})]})}}},function(e){e.O(0,[142,945,282,888,774,179],function(){return e(e.s=4817)}),_N_E=e.O()}]);