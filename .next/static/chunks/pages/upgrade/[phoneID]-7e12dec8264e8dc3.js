(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{4817:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/upgrade/[phoneID]",function(){return s(147)}])},147:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return h}});var a=s(5893),r=s(5675),n=s.n(r),o=s(1163),i=s(7294),l=s(9134),c=s(9066),m=s(9008),d=s.n(m),u=s(6670),h=!0;t.default=e=>{let{seoTitle:t,description:s,productTitle:r,keywords:m,imageUrl:h,formName:p,formID:f,phoneList:x,stateList:g,cityList:y,storeList:w,pageError:S}=e,j="https://lmsservice.unicornstore.in",N=(0,o.useRouter)(),{query:b}=N,[C,_]=(0,i.useState)({name:"",email:"",phone:"",otp:"",product:"",state:"",city:"",store:""}),[v,P]=(0,i.useState)(!1),[E,O]=(0,i.useState)({}),[k,q]=(0,i.useState)(!1),[T,I]=(0,i.useState)(g),[D,A]=(0,i.useState)(y),[F,G]=(0,i.useState)(w);(0,i.useEffect)(()=>{if(C.state){let e=y.filter(e=>e.state_id===C.state);A(e),console.log("filteredCities",e)}else A([])},[C.state,y]),(0,i.useEffect)(()=>{if(C.city){let e=w.filter(e=>e.city_id===C.city);G(e),e.find(e=>e.value===C.store)||_(e=>({...e,store:""}))}else C.state?G(w.filter(e=>e.state_id===C.state)):G(w)},[C.city,C.state,w]);let R=e=>{let{name:t,value:s}=e.target;_({...C,[t]:s}),O(e=>{let a={...e};return"name"!==t||s.trim()?"name"===t&&(a.name=""):a.name="Name is required","email"===t&&(s.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?a.email="":a.email="Email is invalid":a.email="Email is required"),"phone"!==t||s.trim()?"phone"===t&&(a.phone=""):a.phone="Phone Number is required","otp"!==t||s.trim()?"otp"===t&&(a.otp=""):a.otp="OTP is required","state"!==t||s.trim()?"state"===t&&(a.state=""):a.state="State is required",a})},V=(e,t)=>{let s=null==e?void 0:e.value;_(e=>({...e,[t]:s})),console.log(C)},X=e=>{V(e,"state")},Z=e=>{V(e,"city")},$=e=>{V(e,"store")},J=e=>{V(e,"product")};(0,i.useEffect)(()=>{localStorage.removeItem("customer-id"),localStorage.setItem("form-type",f)},[]);let L=async()=>{q(!0);try{let e=await fetch("".concat(j,"/send-otp?phone_number=").concat(C.phone),{method:"POST"});if(!e.ok)throw Error("Could not generate OTP");let t=await e.json();"success"===t.status?(P(!0),setTimeout(()=>{P(!1)},2500)):l.Am.warn(t.reason,{toastId:"warnToast"})}catch(e){console.log(e),l.Am.error(e.message,{toastId:"errorToast"})}q(!1)},M=()=>{let e={};return C.name.trim()||(e.name="Name is required"),C.phone.trim()||(e.phone="Phone Number is required"),C.otp.trim()||(e.otp="OTP is required"),C.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(C.email)||(e.email="Email is invalid"):e.email="Email is required",""===C.product&&(e.product="Product is required"),""===C.state&&(e.state="State is required"),O(e),0===Object.keys(e).length},U=async e=>{if(e.preventDefault(),M())try{let e=await fetch("".concat(j,"/create-form-submission"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{...C,form_name:p,url_data:b}})});if(!e.ok)throw Error("Could not create form");let t=await e.json();"success"!==t.status&&l.Am.info(t.message,{toastId:"infoMessage"}),"success"===t.status&&"form-2"===f?(localStorage.setItem("customer-id",t.form_id),N.push("".concat(b.phoneID,"/payment"))):"success"===t.status&&"form-1"===f&&N.push("".concat(b.phoneID,"/thanks"))}catch(e){console.log(e),l.Am.error("Could not create form")}};return S?(0,a.jsx)("div",{className:"w-screen flex justify-center items-center mt-20 ",children:(0,a.jsxs)("div",{className:"container max-w-screen-lg bg-white shadow-lg rounded-lg p-8 text-red-500 text-center space-y-4",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("i",{className:"bi bi-exclamation-triangle-fill text-red-500 text-6xl"})}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Oops! Something went wrong."}),(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"We encountered an error while trying to fetch the data."}),(0,a.jsx)("button",{className:"bg-red-500 text-white font-semibold px-6 py-3 rounded-full hover:bg-red-600 transition duration-300",onClick:()=>N.reload(),children:"Retry"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d(),{children:[(0,a.jsx)("title",{children:t}),s&&(0,a.jsx)("meta",{name:"description",content:s}),m&&(0,a.jsx)("meta",{name:"keywords",content:m})]}),(0,a.jsx)("div",{className:"w-screen flex justify-center mt-6 sm:mt-0",children:(0,a.jsxs)("div",{className:"container max-w-screen-xl grid grid-cols-2 gap-x-5 gap-y-5",children:[(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsxs)("p",{className:"text-3xl font-semibold text-center",children:["form-1"===f&&"Upgrade","form-2"===f&&"Prebook"," ",r]})}),(0,a.jsx)("div",{className:"flex justify-center items-center col-span-2 sm:col-span-1 ",children:(0,a.jsx)(n(),{className:"max-w-48 sm:max-w-none",src:h||"/ImageNotFound.png",alt:"iPhone 15",width:350,height:100})}),(0,a.jsxs)("div",{className:"max-w-2xl  p-6 bg-white border border-gray-300 rounded col-span-2 sm:col-span-1 mx-2 sm:mx-0",children:["form-1"===f&&(0,a.jsx)(c.Z,{formData:C,errors:E,otpSentVisible:v,phoneList:x,handlePhoneChange:J,currentStates:T,currentCities:D,currentStores:F,handleChange:R,handleGetOtp:L,handleStateChange:X,handleCityChange:Z,handleStoreChange:$,handleFormSubmit:U}),"form-2"===f&&(0,a.jsx)(u.Z,{formData:C,errors:E,otpSentVisible:v,handlePhoneChange:J,currentStates:T,currentCities:D,currentStores:F,handleChange:R,handleGetOtp:L,handleStateChange:X,handleCityChange:Z,handleStoreChange:$,handleFormSubmit:U})]})]})})]})}}},function(e){e.O(0,[723,282,888,774,179],function(){return e(e.s=4817)}),_N_E=e.O()}]);